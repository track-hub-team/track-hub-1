# ----------------------------------------------------------------------------
# Etapa 2: Workflow de Calidad de Código
# Este workflow ejecuta comprobaciones de linting y estilo de código usando
# la misma configuración que los hooks locales de pre-commit.
#
# Comprobaciones:
# - Black: Formateo de código (longitud de línea 120, Python 3.12)
# - isort: Ordenación de imports (perfil black, longitud de línea 120)
# - Flake8: Linting PEP8 (longitud máxima de línea 120, ignorar E203, W503)
# ----------------------------------------------------------------------------

name: Stage 2 - Code Quality

on:
  push:
    branches:
      - '**'

jobs:
  code-quality:
    name: Linting and Formatting
    runs-on: ubuntu-24.04

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Python 3.12
        uses: actions/setup-python@v5
        with:
          python-version: '3.12'

      - name: Install linting dependencies
        run: |
          python -m pip install --upgrade pip
          pip install black==25.1.0 isort==6.0.1 flake8==7.3.0 flake8-pyproject==1.2.3

      - name: Check formatting with Black
        run: |
          echo "Running Black formatter check..."
          black --check --line-length=120 --target-version=py312 app rosemary
        continue-on-error: false

      - name: Check import order with isort
        run: |
          echo "Running isort import checker..."
          isort --check-only --profile=black --line-length=120 app rosemary
        continue-on-error: false

      - name: Lint with Flake8
        run: |
          echo "Running Flake8 linter..."
          flake8 --max-line-length=120 --extend-ignore=E203,W503 --show-source --statistics app rosemary
