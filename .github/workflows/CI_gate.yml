# ----------------------------------------------------------------------------
# Puerta de CI - Comprobación de estado requerida
# Este workflow actúa como una única comprobación de estado obligatoria para la protección de ramas.
#
# Propósito:
# - Espera a que todas las etapas de CI se completen correctamente
# - Proporciona un único punto para la aprobación del merge
# - Simplifica las reglas de protección de ramas
# ----------------------------------------------------------------------------

name: CI Gate

on:
  push:
    branches:
      - '**'

jobs:
  ci-gate:
    name: CI Gate - All Checks Must Pass
    runs-on: ubuntu-24.04

    steps:
      - name: Wait for CI workflows to complete
        uses: lewagon/wait-on-check-action@v1.3.4
        with:
          ref: ${{ github.ref }}
          repo-token: ${{ secrets.GITHUB_TOKEN }}
          wait-interval: 10
          running-workflow-name: 'CI Gate - All Checks Must Pass'
          check-regexp: '^(Validate Commits and Branch Names|Linting and Formatting|Run Tests with Coverage|Dependency Vulnerability Scan)$'

      - name: CI Gate Passed
        run: echo "✅ All CI checks passed. Ready to merge."
